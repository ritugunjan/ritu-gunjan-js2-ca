<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">

</head>

<body>
    <div id="root">


        <div class="w-50 h-50 center_form">
            <div id="register_error">

            </div>
            <div class="mb-3">
                <h1>Login</h1>
            </div>
            <form class="w-50" id="registerform">
                <div class="form-group ">
                    <label for="inputEmail4">Email</label>
                    <input type="email" value="@noroff.no" pattern="^[\w\-.]+@(stud\.)?noroff\.no$" name="email"
                        required class="form-control" id="register_email" placeholder="Email">
                </div>
                <div class="form-group">
                    <label for="inputPassword4">Password</label>
                    <input type="password" required class="form-control" name="password" id="register_password"
                        minlength="8" placeholder="Password">
                </div>
                <div class="d-flex justify-content-between align-center">
                    <a href="/register/">Sign Up</a>
                    <button type="submit" class="btn btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>
</body>

<script src="/api/request.js"></script>
<script type="text/javascript">


    const endpoint = "auth/login";
    const method = "POST";



    function errorMessage(type, err)
    {
        return `<div class="alert ${type}" role="alert">${err}</div>`
    }

    document.getElementById('registerform').addEventListener("submit", async (e) =>
    {
        document.getElementById("register_error").innerHTML = ""
        e.preventDefault()
        const formData = new FormData(e.target);
        const body = Object.fromEntries(formData.entries());
        const response = await fetch(BASE_URL + endpoint, {
            headers: {
                "Content-Type": "application/json",
            },
            method,
            body: JSON.stringify(body),
        });

        try
        {
            const result = await response.json();
            console.log({ result })
            if (result?.statusCode)
            {
                let error = result.errors[0].message ? result.errors[0].message : "Something went wrong"
                document.getElementById("register_error").innerHTML = errorMessage("alert-danger", error)
            } else
            {
                const token = localStorage.setItem(
                    "accessToken",
                    JSON.stringify(result.accessToken)
                );
                localStorage.setItem("username", JSON.stringify(result.email));
                document.getElementById("register_error").innerHTML = errorMessage("alert-success", "Login was success , redirecting to posts")
                setTimeout(() =>
                {
                    window.location = "/"
                }, 500)
            }

            //redirectToPostFeed(token);
        } catch (error)
        {
            //document.getElementById("register_error").innerHTML = errorMessage("alert-danger", error)
            document.getElementById("register_error").innerHTML = errorMessage("alert-danger", error)
            return
        }

        //     method,
        //     body: JSON.stringify(newUser),
        //     headers: {
        //         "Content-type": "application/json; charset=UTF-8",
        //     },
        // };
        // try
        // {
        //     let respose = await sendRequest(endpoint, registerOptions)
        //     console.log(respose)
        //     document.getElementById("register_error").innerHTML = errorMessage("alert-success", "user creation was success , redirecting to login page")
        //     // setTimeout(() =>
        //     // {
        //     //     window.location = "/login/"
        //     // }, 1000)
        // } catch (error)
        // {
        //     document.getElementById("register_error").innerHTML = errorMessage("alert-danger", error.message)
        // }

        //console.log(newUser)
        //login(profile);
    })




</script>
<script src="/api/request.js"></script>

</html>